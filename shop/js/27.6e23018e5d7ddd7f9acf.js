webpackJsonp([27],{"+ad7":function(e,t,a){"use strict";function r(e){a("Ntf1")}Object.defineProperty(t,"__esModule",{value:!0});var o=a("mvHQ"),i=a.n(o),n=a("yt7g"),s=a("Av7u"),l=a.n(s),c=a("S49b"),d={data:function(){return{filters:{name:"",card_no:""},prop:"",order:"",users:[],total:0,page:1,listLoading:!1,supplyBalance:!0,supplyBouns:!0,addFormVisible:!1,addForm:{id:"",store:"",emp:"",amount:""},addLoading:!1,addFormRules:{store:[{required:!0,type:"number",message:"请选择门店",trigger:"change"}],emp:[{required:!0,type:"number",message:"请选择款台",trigger:"change"}],amount:[{required:!0,message:"请输入金额",trigger:"blur"}]},options:[],optionEditEmp:[],loading:!1,loadingEmp:!1,dialogRechargeVisible:!1,formRecharge:{},rulesFormRecharge:{amount:[{validator:function(e,t,a){if(!t)return a(new Error("请输入充值金额"));/(^[1-9]([0-9]+)?(\.[0-9]{1,2})?$)|(^(0){1}$)|(^[0-9]\.[0-9]([0-9])?$)/.test(t)?a():a(new Error("请输入正确的充值金额"))},trigger:"blur"}]},rechargeLoading:!1,ifRecharge:!0}},created:function(){870!==JSON.parse(sessionStorage.getItem("mid"))&&(this.ifRecharge=!1)},methods:{format_actual_balance:function(e,t){return n.i(e.actual_balance,2,".",",")},handleRecharge:function(e,t){this.dialogRechargeVisible=!0,this.formRecharge.wx_name=t.wx_name,this.formRecharge.card_barcode=t.card_barcode,this.formRecharge.memberId=t.id},submitRecharge:function(e){var t=this;this.$refs[e].validate(function(a){if(!a)return!1;var r={amount:t.formRecharge.amount,memberId:t.formRecharge.memberId.toString()};t.rechargeLoading=!0,Object(c._4)(r).then(function(a){t.rechargeLoading=!1,200===a.status&&(t.dialogRechargeVisible=!1,t.$message({message:"恭喜你，充值成功",type:"success"}),t.getUsers(),t.$refs[e].resetFields())})})},addSubmit:function(){var e=this;this.$refs.addForm.validate(function(t){t&&e.$confirm("确认提交吗？","提示",{}).then(function(){e.addLoading=!0;var t={eid:e.addForm.emp.toString(),sid:e.addForm.store.toString(),amount:e.addForm.amount.toString(),memId:e.addForm.id.toString()};Object(c.T)(t).then(function(t){e.addLoading=!1,200==t.status?(e.$message({message:t.message,type:"success"}),e.$refs.addForm.resetFields(),e.addFormVisible=!1,e.getUsers()):e.$message({message:t.message,type:"warning"})})})})},clickEditEmp:function(e){var t=this;if(e){var a={storeId:String(this.addForm.store),ename:""};Object(c._52)(a).then(function(e){var a=(e.status,e.data);t.optionEditEmp=a.emplyeeList})}},remoteEditEmp:function(e){var t=this;""!==e?(this.loading=!0,setTimeout(function(){t.loading=!1,Object(c._52)({ename:String(e),storeId:String(t.addForm.store)}).then(function(e){var a=(e.status,e.data);t.optionEditEmp=a.emplyeeList})},200)):this.optionEditEmp=[]},clickShop:function(e){var t=this;e&&Object(c._54)().then(function(e){var a=(e.status,e.data);t.options=a.storeList})},remoteShop:function(e){var t=this;""!==e?(this.loading=!0,setTimeout(function(){t.loading=!1,Object(c._54)({sname:e}).then(function(e){var a=(e.status,e.data);t.options=a.storeList})},200)):this.options=[]},makeupEdit:function(e,t){this.addForm.id=t.id,this.addFormVisible=!0},cogradientCard:function(){var e=this;this.$prompt("请输入会员卡号","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(t){var a=t.value;Object(c._59)({code:a}).then(function(t){var a=t.status,r=t.message;200==a?e.$message({type:"success",message:r}):e.$message({message:r,type:"warning"})})}).catch(function(){e.$message({type:"info",message:"取消输入"})})},sortChange:function(e){this.prop=e.prop,this.order=e.order,this.getUsers()},resetPassword:function(e,t){var a=this;this.$prompt("请输入重置密码","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"密码格式不正确"}).then(function(e){var r=e.value,o={password:l.a.MD5(r+t.phone+t.card_barcode).toString(l.a.enc.Hex),id:t.id};Object(c._49)(o).then(function(e){var t=e.status,r=e.message;200==t?a.$message({message:r,type:"success"}):a.$message.error(r)})}).catch(function(){a.$message({type:"info",message:"取消输入"})})},creat_time:function(e,t){return e.creat_time=n.f.format(new Date(e.creat_time),"yyyy-MM-dd")},handleCurrentChange:function(e){this.page=e,this.getList()},getUsers:function(){this.page=1,this.getList()},getList:function(){var e=this,t={prop:this.prop,order:this.order,pageNum:this.page,name:this.filters.name,card_no:this.filters.card_no};this.listLoading=!0,Object(c._30)(t).then(function(t){e.listLoading=!1,e.supplyBalance=t.data.supplyBalance,e.supplyBouns=t.data.supplyBouns,e.total=t.data.total||0,e.users=t.data.memberList})},handleEdit:function(e,t){var a=t.card_no;sessionStorage.setItem("card_no",i()(a)),this.$router.push("/index3/tab6")}},mounted:function(){this.getUsers()}},m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("el-row",[a("el-form",{attrs:{inline:!0,model:e.filters}},[a("el-form-item",{attrs:{label:"持卡人姓名"}},[a("el-input",{staticClass:"fixed_search_input",attrs:{placeholder:"持卡人姓名"},model:{value:e.filters.name,callback:function(t){e.$set(e.filters,"name",t)},expression:"filters.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"会员卡号"}},[a("el-input",{staticClass:"fixed_search_input",attrs:{placeholder:"会员卡号"},model:{value:e.filters.card_no,callback:function(t){e.$set(e.filters,"card_no",t)},expression:"filters.card_no"}})],1),e._v(" "),a("el-form-item",{staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary",round:""},on:{click:e.getUsers}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{type:"primary",round:""},on:{click:e.cogradientCard}},[e._v("同步会员卡")])],1)],1)],1),e._v(" "),[a("el-table",{attrs:{data:e.users,border:"","highlight-current-row":""},on:{"sort-change":e.sortChange}},[a("el-table-column",{attrs:{prop:"card_no",label:"会员卡号","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"wx_name",label:"微信昵称","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"持卡人","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"phone",label:"手机号","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"creat_time",label:"领卡时间",formatter:e.creat_time,"min-width":"95"}}),e._v(" "),e.supplyBouns?a("el-table-column",{attrs:{prop:"account_bouns",label:"积分",sortable:"custom","min-width":"120"}}):e._e(),e._v(" "),e.supplyBalance?a("el-table-column",{attrs:{prop:"actual_balance",label:"余额（元）",sortable:"custom","min-width":"130",formatter:e.format_actual_balance}}):e._e(),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作",width:"480"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(a){e.makeupEdit(t.$index,t.row)}}},[e._v("线下消费补录")]),e._v(" "),e.supplyBalance?a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(a){e.resetPassword(t.$index,t.row)}}},[e._v("会员卡支付密码重置")]):e._e(),e._v(" "),a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){e.handleEdit(t.$index,t.row)}}},[e._v("消费记录")]),e._v(" "),e.ifRecharge?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){e.handleRecharge(t.$index,t.row)}}},[e._v("充值")]):e._e()]}}])})],1)],e._v(" "),a("el-dialog",{attrs:{title:"会员充值",visible:e.dialogRechargeVisible,width:"30%"},on:{"update:visible":function(t){e.dialogRechargeVisible=t}}},[a("el-form",{ref:"formRecharge",attrs:{"status-icon":"",rules:e.rulesFormRecharge,model:e.formRecharge,"label-width":"100px"}},[a("el-form-item",{staticClass:"table_recharge",attrs:{label:"微信昵称："}},[a("span",[e._v(e._s(e.formRecharge.wx_name))])]),e._v(" "),a("el-form-item",{staticClass:"table_recharge",attrs:{label:"会员卡号："}},[a("span",[e._v(e._s(e.formRecharge.card_barcode))])]),e._v(" "),a("el-form-item",{staticClass:"table_recharge",attrs:{label:"充值金额：",prop:"amount"}},[a("el-input",{attrs:{clearable:""},model:{value:e.formRecharge.amount,callback:function(t){e.$set(e.formRecharge,"amount",t)},expression:"formRecharge.amount"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogRechargeVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.rechargeLoading},on:{click:function(t){e.submitRecharge("formRecharge")}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-row",[a("el-pagination",{staticStyle:{"text-align":"center",background:"#fff",padding:"15px"},attrs:{layout:"prev, pager, next","current-page":e.page,"page-size":20,total:e.total,background:""},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"线下消费补录",visible:e.addFormVisible,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(t){e.addFormVisible=t}}},[a("el-form",{ref:"addForm",attrs:{model:e.addForm,"label-width":"100px",rules:e.addFormRules}},[a("el-form-item",{attrs:{label:"选择门店",prop:"store"}},[a("el-select",{attrs:{placeholder:"请选择门店名称",multiple:!1,filterable:"",remote:"","remote-method":e.remoteShop,loading:e.loading,clearable:""},on:{"visible-change":e.clickShop},model:{value:e.addForm.store,callback:function(t){e.$set(e.addForm,"store",t)},expression:"addForm.store"}},e._l(e.options,function(e){return a("el-option",{key:e.id,attrs:{value:e.id,label:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"选择款台",prop:"emp"}},[a("el-select",{attrs:{placeholder:"请选择款台",multiple:!1,filterable:"",remote:"","remote-method":e.remoteEditEmp,loading:e.loadingEmp,clearable:""},on:{"visible-change":e.clickEditEmp},model:{value:e.addForm.emp,callback:function(t){e.$set(e.addForm,"emp",t)},expression:"addForm.emp"}},e._l(e.optionEditEmp,function(e){return a("el-option",{key:e.eid,attrs:{value:e.eid,label:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"消费金额",prop:"amount"}},[a("el-input",{staticStyle:{"max-width":"217px"},attrs:{"auto-complete":"off"},model:{value:e.addForm.amount,callback:function(t){e.$set(e.addForm,"amount",t)},expression:"addForm.amount"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.addFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.addLoading},nativeOn:{click:function(t){return e.addSubmit(t)}}},[e._v("提交")])],1)],1)],2)},u=[],p={render:m,staticRenderFns:u},g=p,f=a("VU/8"),h=r,b=f(d,g,!1,h,null,null);t.default=b.exports},Ntf1:function(e,t,a){var r=a("fPZ6");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a("rjj0")("0d2bfd33",r,!0,{})},fPZ6:function(e,t,a){t=e.exports=a("FZ+f")(!1),t.push([e.i,"\n.table_recharge {\n  font-size: 0;\n}\n.table_recharge label {\n  width: 90px;\n  color: #99a9bf;\n}\n.table_recharge .el-form-item {\n  margin-right: 0;\n  margin-bottom: 0;\n  width: 50%;\n}\n",""])}});